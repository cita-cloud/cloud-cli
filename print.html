<!DOCTYPE HTML>
<html lang="zh-CN" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>cloud-cli Documentation</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">简介</a></li><li class="chapter-item expanded affix "><li class="part-title">使用说明</li><li class="chapter-item expanded "><a href="installation.html"><strong aria-hidden="true">1.</strong> 安装</a></li><li class="chapter-item expanded "><a href="quick-start.html"><strong aria-hidden="true">2.</strong> 快速入门</a></li><li class="chapter-item expanded "><a href="cmd-references.html"><strong aria-hidden="true">3.</strong> 命令介绍</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cmd/get.html"><strong aria-hidden="true">3.1.</strong> get</a></li><li class="chapter-item expanded "><a href="cmd/send.html"><strong aria-hidden="true">3.2.</strong> send</a></li><li class="chapter-item expanded "><a href="cmd/call.html"><strong aria-hidden="true">3.3.</strong> call</a></li><li class="chapter-item expanded "><a href="cmd/create.html"><strong aria-hidden="true">3.4.</strong> create</a></li><li class="chapter-item expanded "><a href="cmd/account.html"><strong aria-hidden="true">3.5.</strong> account</a></li><li class="chapter-item expanded "><a href="cmd/context.html"><strong aria-hidden="true">3.6.</strong> context</a></li><li class="chapter-item expanded "><a href="cmd/admin.html"><strong aria-hidden="true">3.7.</strong> admin</a></li><li class="chapter-item expanded "><a href="cmd/rpc.html"><strong aria-hidden="true">3.8.</strong> rpc</a></li><li class="chapter-item expanded "><a href="cmd/ethabi.html"><strong aria-hidden="true">3.9.</strong> ethabi</a></li><li class="chapter-item expanded "><a href="cmd/bench.html"><strong aria-hidden="true">3.10.</strong> bench</a></li><li class="chapter-item expanded "><a href="cmd/watch.html"><strong aria-hidden="true">3.11.</strong> watch</a></li><li class="chapter-item expanded "><a href="cmd/completions.html"><strong aria-hidden="true">3.12.</strong> completions</a></li></ol></li><li class="chapter-item expanded "><a href="architecture.html"><strong aria-hidden="true">4.</strong> 设计架构</a></li><li class="chapter-item expanded "><a href="dev-guide.html"><strong aria-hidden="true">5.</strong> 开发指南</a></li><li class="chapter-item expanded "><a href="trouble-shooting.html"><strong aria-hidden="true">6.</strong> 错误排查</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">cloud-cli Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="cloud-cli"><a class="header" href="#cloud-cli">cloud-cli</a></h1>
<p><code>cloud-cli</code>（简称<code>cldi</code>）是CITA-Cloud命令行工具。它封装了CITA-Cloud构建的链提供的gRPC接口，并提供了一些辅助功能，方便用户与链进行交互。</p>
<pre><code class="language-plaintext">$ cldi help
The command line interface to interact with CITA-Cloud

Usage: cldi [OPTIONS] [COMMAND]

Commands:
  get          Get data from chain
  send         Send transaction
  call         Call executor
  create       create an EVM contract
  context      Context commands
  account      Account commands
  admin        The admin commands for managing chain
  rpc          Other RPC commands
  ethabi       Ethereum ABI coder.
  bench        Simple benchmarks
  watch        Watch blocks
  completions  Generate completions for current shell. Add the output script to `.profile` or `.bashrc` etc. to make it effective.
  help         Print this message or the help of the given subcommand(s)

Options:
  -c, --context &lt;context&gt;           context setting
  -r &lt;controller-addr&gt;              controller address
  -e &lt;executor-addr&gt;                executor address
  -u &lt;account-name&gt;                 account name
  -p &lt;password&gt;                     password to unlock the account
      --crypto &lt;crypto-type&gt;        The crypto type of the target chain [possible values: SM, ETH]
      --consensus &lt;consensus-type&gt;  The consensus type of the target chain [possible values: BFT, OVERLORD, RAFT]
  -h, --help                        Print help information
  -V, --version                     Print version information
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="安装"><a class="header" href="#安装">安装</a></h1>
<p>有几种不同的安装方法。</p>
<h2 id="直接下载预编译的二进制文件"><a class="header" href="#直接下载预编译的二进制文件">直接下载预编译的二进制文件</a></h2>
<p>cldi有预编译好的二进制可执行文件，可以根据使用环境下载对应的文件。
<a href="https://github.com/cita-cloud/cloud-cli/releases">下载链接</a></p>
<p>如果你不知道如何选择，那么一般来说:</p>
<ul>
<li>cldi-x86_64-pc-windows-msvc.zip，如果你是在Windows下</li>
<li>cldi-x86_64-unknown-linux-gnu.tar.gz，如果你是在Linux下</li>
<li>cldi-x86_64-apple-darwin.tar.gz，如果你是在MacOS下（非M1）</li>
<li>cldi-aarch64-apple-darwin.tar.gz，如果你是在MacOS下（M1）</li>
</ul>
<p>如果出现libc相关问题，可以使用musl版。</p>
<p>如果在ARM上，使用aarch64版。</p>
<h2 id="从源码编译"><a class="header" href="#从源码编译">从源码编译</a></h2>
<h3 id="1-安装rust"><a class="header" href="#1-安装rust">1. 安装Rust</a></h3>
<p>如果你没有Rust环境，可以执行以下命令，通过rustup安装。</p>
<pre><code class="language-bash">curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
</code></pre>
<h3 id="2-编译并安装cloud-cli"><a class="header" href="#2-编译并安装cloud-cli">2. 编译并安装cloud-cli</a></h3>
<p>更新Rust版本。</p>
<pre><code class="language-bash"># cloud-cli requires rust 1.58 or above
$ rustup update
</code></pre>
<p>可以通过GitHub安装。</p>
<pre><code class="language-bash">$ cargo install --git https://github.com/cita-cloud/cloud-cli --branch main
</code></pre>
<p>也可以先把项目clone到本地。</p>
<pre><code class="language-bash">$ git clone https://github.com/cita-cloud/cloud-cli
$ cargo install --path cloud-cli
</code></pre>
<h2 id="验证安装"><a class="header" href="#验证安装">验证安装</a></h2>
<pre><code class="language-plaintext">$ cldi --version
cldi 0.5.5
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="快速入门"><a class="header" href="#快速入门">快速入门</a></h1>
<h2 id="配置"><a class="header" href="#配置">配置</a></h2>
<h3 id="1-controller和executor的地址"><a class="header" href="#1-controller和executor的地址">1. controller和executor的地址</a></h3>
<p>想要与链交互，首先要知道如何访问链。</p>
<p>CITA-Cloud有两个rpc地址，分别是controller和executor微服务。</p>
<p>假设controller的地址为&quot;localhost:50004&quot;, executor的地址为&quot;localhost:50002&quot;。</p>
<p>那么我们可以通过<code>-r</code>和<code>-e</code>来告诉cldi如何访问链：</p>
<pre><code class="language-bash"># 注意-r和-e必须在子命令之前
$ cldi -r localhost:50004 -e localhost:50002 get block-number
</code></pre>
<h3 id="2-账户名称"><a class="header" href="#2-账户名称">2. 账户名称</a></h3>
<p>发送交易的命令需要对交易进行签名，我们需要指定签名所使用的账户。
cldi在第一次使用的时候会创建一个名为<code>default</code>的默认账户，用户可以通过<code>-u</code>来指定账户：</p>
<pre><code class="language-bash"># 同样地，-u必须在子命令之前
$ cldi -u Alice send --to &lt;to&gt; --value &lt;value&gt; --data &lt;data&gt;
</code></pre>
<p>创建和导入账户相关的命令请参见<a href="cmd/account.html">account</a>。</p>
<h2 id="使用context管理配置"><a class="header" href="#使用context管理配置">使用Context管理配置</a></h2>
<p>每次都指定微服务的访问地址和使用的账户名称不太方便，我们可以通过context命令来管理这些配置。</p>
<pre><code class="language-bash"># 创建一个Context
$ cldi -r localhost:50004 -e localhost:50002 -u Alice context save Wonderland
# 将这个Context设为默认
$ cldi context default Wonderland
# 也可以使用-c来切换Context，-c也必须在子命令之前
$ cldi -c Wonderland get block-number
# 列出当前Context信息和已保存的Context
$ cldi context list
</code></pre>
<h2 id="交互模式"><a class="header" href="#交互模式">交互模式</a></h2>
<p>cldi提供了命令行模式和交互模式，在未传入子命令的时候cldi会进入交互模式。</p>
<p>交互模式与命令行模式的命令是等价的，例如：</p>
<pre><code class="language-bash">$ cldi get block-number
</code></pre>
<p>等价于</p>
<pre><code class="language-bash">$ cldi
cldi&gt; get block-number
</code></pre>
<p>在交互模式下，用户可以通过<code>-c</code>, <code>-r</code> <code>-e</code>来改变当前会话的Context配置。</p>
<pre><code class="language-bash"># 修改当前会话的全局配置
cldi&gt; -r localhost:50004
# 仅针对这条命令应用这个配置
cldi&gt; -r localhost:50004 get block-number
</code></pre>
<p>Q: How to quit cldi?<br>
<del>A: :q</del><br>
A: CTRL-D</p>
<h2 id="缩写"><a class="header" href="#缩写">缩写</a></h2>
<p>cldi提供了很多命令的缩写，这里列举一些：</p>
<pre><code class="language-plaintext">cldi&gt; get block-number
cldi&gt; get bn

cldi&gt; get system-config
cldi&gt; get sc

cldi&gt; context list
cldi&gt; ctx ls
cldi&gt; ctx l

cldi&gt; account generate --name Alice
cldi&gt; account gen --name Alice
cldi&gt; account g --name Alice
cldi&gt; a g --name Alice

cldi&gt; bench send
cldi&gt; b send

cldi&gt; watch
cldi&gt; w
</code></pre>
<p>这些缩写仅为方便用户操作，不作稳定性保证，不建议在脚本中使用。</p>
<h2 id="命令行模式下的补全"><a class="header" href="#命令行模式下的补全">命令行模式下的补全</a></h2>
<p><code>cldi completions &lt;shell-name&gt;</code>命令会输出补全脚本，需要添加到, 例如<code>.profile</code>, <code>.bashrc</code>里才能生效。目前支持的shell有：<code>bash</code>, <code>zsh</code>, <code>powershell</code>, <code>fish</code>, <code>elvish</code>。</p>
<p>以bash为例，将下列脚本添加到<code>.bashrc</code>里即可。</p>
<pre><code class="language-bash">source &lt;(cldi completions bash)
</code></pre>
<h2 id="使用示例"><a class="header" href="#使用示例">使用示例</a></h2>
<h3 id="1生成账户"><a class="header" href="#1生成账户">1.生成账户</a></h3>
<p>如果需要更好的安全性，请加上<code>-p &lt;password&gt;</code>为私钥进行加密。
有密码的账户在硬盘上会进行加密存储，并且不会在生成时显示明文私钥。
加密后的账户需要经过<code>-p &lt;password&gt;</code>解密才能使用。</p>
<pre><code class="language-plaintext">cldi&gt; account generate --name Alice
{
  &quot;crypto_type&quot;: &quot;SM&quot;,
  &quot;address&quot;: &quot;0xb7768b2f989eeb9a1c7315aa38fb5fbd68333b8a&quot;,
  &quot;public_key&quot;: &quot;0x325ef60c3d8a94dd363a83f8b9a1ecbe3583b41aa204709eb0d2a19e7e323571d6d4015e5a049bfd04d3ff661385c36fe2066f9aaf72c943ff4ad1fc15e03e73&quot;,
  &quot;secret_key&quot;: &quot;0x9d08b671a8f12141c45edbd59e81eaf282a2534505ad0545bb46bf64d642b071&quot;
}
</code></pre>
<h3 id="2创建环境配置"><a class="header" href="#2创建环境配置">2.创建环境配置</a></h3>
<pre><code class="language-bash">cldi&gt; -r localhost:50004 -e localhost:50002 -u Alice context save Wonderland
# 设为默认环境
cldi&gt; context default Wonderland
</code></pre>
<h3 id="3查询块高"><a class="header" href="#3查询块高">3.查询块高</a></h3>
<pre><code class="language-plaintext">cldi&gt; get block-number
406030
</code></pre>
<h3 id="4查询系统配置"><a class="header" href="#4查询系统配置">4.查询系统配置</a></h3>
<pre><code class="language-plaintext">cldi&gt; get system-config
{
  &quot;admin&quot;: &quot;0x753dd50f878f08647a0105dd44aa3f4b7cf3408d&quot;,
  &quot;admin_pre_hash&quot;: &quot;0x000000000000000000000000000000000000000000000000000000000000000000&quot;,
  &quot;block_interval&quot;: 3,
  &quot;block_interval_pre_hash&quot;: &quot;0x000000000000000000000000000000000000000000000000000000000000000000&quot;,
  &quot;block_limit&quot;: 100,
  &quot;block_limit_pre_hash&quot;: &quot;0x000000000000000000000000000000000000000000000000000000000000000000&quot;,
  &quot;chain_id&quot;: &quot;0x63586a3c0255f337c77a777ff54f0040b8c388da04f23ecee6bfd4953a6512b4&quot;,
  &quot;chain_id_pre_hash&quot;: &quot;0x000000000000000000000000000000000000000000000000000000000000000000&quot;,
  &quot;emergency_brake&quot;: false,
  &quot;emergency_brake_pre_hash&quot;: &quot;0x000000000000000000000000000000000000000000000000000000000000000000&quot;,
  &quot;quota_limit&quot;: 1073741824,
  &quot;quota_limit_pre_hash&quot;: &quot;0x000000000000000000000000000000000000000000000000000000000000000000&quot;,
  &quot;validators&quot;: [
    &quot;0x74f1bf7351bf97d7217a9232aa0074e303018f7d&quot;,
    &quot;0xcee098ece4e372a2f0b4f6bebad04f2111fd1c26&quot;,
    &quot;0xfef8db7854b88c6e914a7e21af61b0f485fc3f0d&quot;,
    &quot;0xc3bebda27a8f2ae3c8f4d79b656a5cee2db9421c&quot;
  ],
  &quot;validators_pre_hash&quot;: &quot;0x000000000000000000000000000000000000000000000000000000000000000000&quot;,
  &quot;version&quot;: 0,
  &quot;version_pre_hash&quot;: &quot;0x000000000000000000000000000000000000000000000000000000000000000000&quot;
}

</code></pre>
<h3 id="5创建合约"><a class="header" href="#5创建合约">5.创建合约</a></h3>
<p>我们通过<code>cldi create &lt;data&gt;</code>发送创建合约交易。其中<code>&lt;data&gt;</code>是合约的数据，这里以一个计数器合约为例。返回结果为这个创建合约交易的哈希。</p>
<pre><code class="language-plaintext">cldi&gt; create 0x608060405234801561001057600080fd5b5060f58061001f6000396000f3006080604052600436106053576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806306661abd1460585780634f2be91f146080578063d826f88f146094575b600080fd5b348015606357600080fd5b50606a60a8565b6040518082815260200191505060405180910390f35b348015608b57600080fd5b50609260ae565b005b348015609f57600080fd5b5060a660c0565b005b60005481565b60016000808282540192505081905550565b600080819055505600a165627a7a72305820faa1d1f51d7b5ca2b200e0f6cdef4f2d7e44ee686209e300beb1146f40d32dee0029
0xbdeabf94a31c503deb4400fc63aee2a89e8f43d6570ed7ad5cd4f6f2898be0a2
</code></pre>
<p>等待交易上链后，通过<code>cldi get receipt &lt;tx-hash&gt;</code>获取交易回执，在交易回执中的<code>contract_addr</code>项查看创建出来的合约的地址。这里为<code>0xf064e32407b6cc412fe33f6ba55f578ac413ecdc</code></p>
<pre><code class="language-plaintext">cldi&gt; get receipt 0xbdeabf94a31c503deb4400fc63aee2a89e8f43d6570ed7ad5cd4f6f2898be0a2
{
  &quot;block_number&quot;: 406069,
  &quot;contract_addr&quot;: &quot;0xf064e32407b6cc412fe33f6ba55f578ac413ecdc&quot;,
  &quot;cumulative_quota_used&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000018ed3&quot;,
  &quot;error_msg&quot;: &quot;&quot;,
  &quot;legacy_cita_block_hash&quot;: &quot;0x265386a6afc6072f0acb5d32e0fe079e101129041dbfed2bee8872a849e8f7a3&quot;,
  &quot;logs&quot;: [],
  &quot;logs_bloom&quot;: &quot;0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;,
  &quot;quota_used&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000018ed3&quot;,
  &quot;state_root&quot;: &quot;0x96899ff87f9bed55fd880750c2c51661ee24e14f672a1c9d7ac9573536b8c3f0&quot;,
  &quot;tx_hash&quot;: &quot;0xbdeabf94a31c503deb4400fc63aee2a89e8f43d6570ed7ad5cd4f6f2898be0a2&quot;,
  &quot;tx_index&quot;: 0
}
</code></pre>
<h3 id="6调用合约"><a class="header" href="#6调用合约">6.调用合约</a></h3>
<p>查询合约数据。当前计数器的值为0。</p>
<pre><code class="language-plaintext">cldi&gt; call 0xf064e32407b6cc412fe33f6ba55f578ac413ecdc 0x06661abd
0x0000000000000000000000000000000000000000000000000000000000000000
</code></pre>
<p>发送交易，使得计数器加一。</p>
<pre><code class="language-plaintext">cldi&gt; send 0xf064e32407b6cc412fe33f6ba55f578ac413ecdc 0x4f2be91f
0x99e57fdfed555059fa143ad0bc4d8ddc8764f8024fb3b28e880a84667414dec5
</code></pre>
<p>等待交易上链后，再次查询，可以看到结果为一，符合预期。</p>
<pre><code class="language-plaintext">cldi&gt; call 0xf064e32407b6cc412fe33f6ba55f578ac413ecdc 0x06661abd
0x0000000000000000000000000000000000000000000000000000000000000001
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="命令介绍"><a class="header" href="#命令介绍">命令介绍</a></h1>
<p><code>cldi</code>是对<a href="https://github.com/cita-cloud/cita_cloud_proto">CITA-Cloud协议</a>定义的对外的gRPC接口的封装。</p>
<p>这里列出这些接口以供参考。</p>
<h2 id="controller的接口"><a class="header" href="#controller的接口">controller的接口</a></h2>
<p><a href="https://github.com/cita-cloud/cita_cloud_proto/blob/master/protos/controller.proto#L53-L90">controller proto</a></p>
<pre><code class="language-protobuf">service RPCService {
    // flag means latest or pending.
    // true means pending, false means latest.
    rpc GetBlockNumber(Flag) returns (BlockNumber);

    rpc SendRawTransaction(blockchain.RawTransaction) returns (common.Hash);

    rpc SendRawTransactions(blockchain.RawTransactions) returns (common.Hashes);

    rpc GetBlockByHash(common.Hash) returns (blockchain.CompactBlock);

    rpc GetHeightByHash(common.Hash) returns (BlockNumber);

    rpc GetBlockByNumber(BlockNumber) returns (blockchain.CompactBlock);

    rpc GetStateRootByNumber (BlockNumber) returns (common.StateRoot);

    rpc GetProofByNumber (BlockNumber) returns (common.Proof);

    rpc GetBlockDetailByNumber(BlockNumber) returns (blockchain.Block);

    rpc GetTransaction(common.Hash) returns (blockchain.RawTransaction);

    rpc GetSystemConfig(common.Empty) returns (SystemConfig);

    rpc GetSystemConfigByNumber(BlockNumber) returns (SystemConfig);

    rpc GetBlockHash(BlockNumber) returns (common.Hash);

    rpc GetTransactionBlockNumber(common.Hash) returns (BlockNumber);

    rpc GetTransactionIndex(common.Hash) returns (TransactionIndex);

    // add new node
    rpc AddNode(common.NodeNetInfo) returns (common.StatusCode);

    rpc GetNodeStatus(common.Empty) returns (common.NodeStatus);
}
</code></pre>
<h2 id="executor的接口"><a class="header" href="#executor的接口">executor的接口</a></h2>
<p><a href="https://github.com/cita-cloud/cita_cloud_proto/blob/master/protos/executor.proto#L41-L46">executor proto</a></p>
<p>其中call的数据格式由具体的executor微服务定义。</p>
<pre><code class="language-protobuf">service ExecutorService {
    // exec a block return executed_block_hash
    rpc Exec(blockchain.Block) returns (common.HashResponse);

    rpc Call(CallRequest) returns (CallResponse);
}
</code></pre>
<h2 id="executor_evm的接口"><a class="header" href="#executor_evm的接口">executor_evm的接口</a></h2>
<p><a href="https://github.com/cita-cloud/cita_cloud_proto/blob/master/protos/vm/evm.proto#L69-L81">executor_evm proto</a></p>
<pre><code class="language-protobuf">service RPCService {
  rpc GetTransactionReceipt(common.Hash) returns (Receipt);

  rpc GetCode(common.Address) returns (ByteCode);

  rpc GetBalance(common.Address) returns (Balance);

  rpc GetTransactionCount(common.Address) returns (Nonce);

  rpc GetAbi(common.Address) returns (ByteAbi);

  rpc EstimateQuota(executor.CallRequest) returns (ByteQuota);
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="get"><a class="header" href="#get">get</a></h1>
<p>获取链上数据相关的命令。</p>
<pre><code class="language-plaintext">$ cldi help get
Get data from chain

Usage: cldi get &lt;COMMAND&gt;

Commands:
  abi            Get the specific contract ABI
  balance        Get balance by account address
  block          Get block by block height or hash(0x)
  code           Get code by contract address
  tx             Get transaction data by tx_hash
  nonce          Get the nonce of this account
  receipt        Get EVM execution receipt by tx_hash
  system-config  Get system config
  block-hash     Get block hash by block height
  block-number   Get block number
  node-status    Get node status
  help           Print this message or the help of the given subcommand(s)

Options:
  -h, --help  Print help information
</code></pre>
<h2 id="blcok-number"><a class="header" href="#blcok-number">blcok-number</a></h2>
<p>获取节点当前已确认的块高。</p>
<pre><code class="language-bash">cldi&gt; get block-number
cldi&gt; g bn
</code></pre>
<p>获取尚未确认的块高。</p>
<pre><code class="language-bash">cldi&gt; get block-number -p
</code></pre>
<h2 id="receipt"><a class="header" href="#receipt">receipt</a></h2>
<p>获取EVM执行后的交易回执，注意它和get-tx不同，get-tx获取的是交易数据。</p>
<pre><code class="language-bash">cldi&gt; get receipt 0x8efa5acafdb1a48de23231444d7f28c64d22ebe17a5889a08aeeb3bdd7303197
cldi&gt; g r 0x8efa5acafdb1a48de23231444d7f28c64d22ebe17a5889a08aeeb3bdd7303197
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="send"><a class="header" href="#send">send</a></h1>
<p>发送交易。</p>
<p>注意和<code>cita-cli</code>不同，<code>&lt;to&gt;</code>是必传参数，如果想要创建合约，请使用create命令。</p>
<pre><code class="language-plaintext">$ cldi help send
cldi-send
Send transaction

USAGE:
    cldi send [OPTIONS] &lt;to&gt; [data]

ARGS:
    &lt;to&gt;      the target address of this tx
    &lt;data&gt;    the data of this tx [default: 0x]

OPTIONS:
    -v, --value &lt;value&gt;                the value of this tx [default: 0x0]
    -q, --quota &lt;quota&gt;                the quota of this tx [default: 200000]
        --until &lt;valid-until-block&gt;    this tx is valid until the given block height. `+h` means
                                       `&lt;current-height&gt; + h` [default: +95]
    -h, --help                         Print help information
</code></pre>
<p><code>valid_until_block</code>用来限制交易的有效范围，即在多少高度之前可以被打包，可以指定一个确定的高度（例如100），也可以指定为当前高度加多少（例如+95）。</p>
<h2 id="示例"><a class="header" href="#示例">示例</a></h2>
<pre><code class="language-plaintext">cldi&gt; send 0xf064e32407b6cc412fe33f6ba55f578ac413ecdc 0x4f2be91f
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="call"><a class="header" href="#call">call</a></h1>
<p>调用executor提供的call。</p>
<p>这里用到的<code>&lt;data&gt;</code>是经过ethabi编码的数据。</p>
<pre><code class="language-plaintext">$ cldi help call
cldi-call
Call executor

USAGE:
    cldi call [OPTIONS] &lt;to&gt; &lt;data&gt; [height]

ARGS:
    &lt;to&gt;        the target contract address
    &lt;data&gt;      the data of this call request
    &lt;height&gt;    the height of this call request

OPTIONS:
    -f, --from &lt;from&gt;    default to use current account address
    -h, --help           Print help information
</code></pre>
<p><code>height</code>为可选参数，不传递则表示默认取最新高度。</p>
<h2 id="示例-1"><a class="header" href="#示例-1">示例</a></h2>
<pre><code class="language-plaintext">cldi&gt; call 0xf064e32407b6cc412fe33f6ba55f578ac413ecdc 0x06661abd
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="create"><a class="header" href="#create">create</a></h1>
<p>发送交易创建EVM上的合约。合约地址可以在交易的receipt里的contract_addr中查看。</p>
<pre><code class="language-plaintext">$ cldi help create
cldi-create
create an EVM contract

USAGE:
    cldi create [OPTIONS] &lt;data&gt;

ARGS:
    &lt;data&gt;    the data of this tx

OPTIONS:
    -v, --value &lt;value&gt;                the value of this tx [default: 0x0]
    -q, --quota &lt;quota&gt;                the quota of this tx [default: 1073741824]
        --until &lt;valid-until-block&gt;    this tx is valid until the given block height. `+h` means
                                       `&lt;current-height&gt; + h` [default: +95]
    -h, --help                         Print help information
</code></pre>
<h2 id="示例-2"><a class="header" href="#示例-2">示例</a></h2>
<pre><code class="language-plaintext">cldi&gt; create 0x608060405234801561001057600080fd5b5060f58061001f6000396000f3006080604052600436106053576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806306661abd1460585780634f2be91f146080578063d826f88f146094575b600080fd5b348015606357600080fd5b50606a60a8565b6040518082815260200191505060405180910390f35b348015608b57600080fd5b50609260ae565b005b348015609f57600080fd5b5060a660c0565b005b60005481565b60016000808282540192505081905550565b600080819055505600a165627a7a72305820faa1d1f51d7b5ca2b200e0f6cdef4f2d7e44ee686209e300beb1146f40d32dee0029
``
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="account"><a class="header" href="#account">account</a></h1>
<p>account相关命令。</p>
<p><strong>警告</strong>：设置了密码的账户在硬盘上是经过加密后存储的，虽然加密算法本身可靠，但在加密算法之外可能存在其它安全漏洞（例如<code>account delete</code>没有安全覆写原明文私钥），代码未经安全审计，作者亦非安全专家，不能保证安全性，使用者风险自负(Use at your own risk)。</p>
<pre><code class="language-plaintext">$ cldi help account
cldi-account
Account commands

USAGE:
    cldi account &lt;SUBCOMMAND&gt;

OPTIONS:
    -h, --help    Print help information

SUBCOMMANDS:
    generate    generate a new account
    list        list accounts
    import      import account
    export      export account
    unlock      unlock account in keystore
    lock        lock account in keystore
    delete      delete account
    help        Print this message or the help of the given subcommand(s)
</code></pre>
<p>当前使用的账户可以在<code>context list</code>展示的的current setting中查看。</p>
<p>如果需要安全地删除账户，可以在<code>$HOME/.cloud-cli/accounts</code>下找到账户名对应的toml文件，使用带有防止恢复功能的删除工具删除（粉碎文件）。</p>
<p>带密码的账户需要在cldi命令下传入<code>-p &lt;password&gt;</code>解锁，用法与<code>-c</code>, <code>-r</code>等命令相似。</p>
<h2 id="带密码的账号"><a class="header" href="#带密码的账号">带密码的账号</a></h2>
<p>创建一个带密码的账户root，这个账户root在当前交互会话下可用，无需再输入密码</p>
<pre><code class="language-plaintext">$ cldi
cldi&gt; account generate --name root --password root
{
  &quot;crypto_type&quot;: &quot;SM&quot;,
  &quot;address&quot;: &quot;0xb293c14d8fc8ff4b24db3926118388b562593d99&quot;,
  &quot;public_key&quot;: &quot;0x411b418b10005ec32aacf6412a097e87680b29795f723844f6c90e2e850b9d618640ad0fa3011dd67bb667f31656476eb13fdef63329c4756ebd44d3ca265c08&quot;,
  &quot;encrypted_sk&quot;: &quot;0x36aa2663fa3c2626d7acf051f6a49a81280d7422b49551bcaf9c187d14af2b0d&quot;
}
</code></pre>
<p>按CTRL-D退出交互模式，重新进入。注意这里可以在进入时直接选中这个账号root</p>
<pre><code class="language-plaintext">$ cldi -u root
cldi&gt;
</code></pre>
<p>尝试在不输入密码的情况下使用这个账号，可以看到报错</p>
<pre><code class="language-plaintext">cldi&gt; send 0xb293c14d8fc8ff4b24db3926118388b562593d99
cannot get current account `root`

Caused by:
    account is locked, please unlock it first(e.g. `cldi -p &lt;password&gt; [subcommand]`)
</code></pre>
<p>输入密码，与其它命令相似，不带子命令是为当前会话解锁账户，带了子命令则只针对这条子命令。</p>
<pre><code class="language-plaintext">cldi&gt; -p root
cldi&gt; send 0xb293c14d8fc8ff4b24db3926118388b562593d99
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="context"><a class="header" href="#context">context</a></h1>
<p>context相关命令。</p>
<pre><code class="language-plaintext">$ cldi help context
cldi-context
Context commands

USAGE:
    cldi context &lt;SUBCOMMAND&gt;

OPTIONS:
    -h, --help    Print help information

SUBCOMMANDS:
    save       save context
    list       list contexts
    delete     delete context
    default    set a context as default and switch current context to it
    help       Print this message or the help of the given subcommand(s)
</code></pre>
<h2 id="context-list"><a class="header" href="#context-list">context list</a></h2>
<p>列出环境配置信息。</p>
<pre><code class="language-plaintext">cldi&gt; context list
cldi&gt; ctx ls
cldi&gt; ctx l
</code></pre>
<pre><code class="language-json">{
  // 当前保存的所有环境配置
  &quot;contexts&quot;: {
    // 环境配置的名字
    &quot;default&quot;: {
       // 这个配置所用的账户名
      &quot;account_name&quot;: &quot;default&quot;,
       // controller地址
      &quot;controller_addr&quot;: &quot;localhost:50004&quot;,
       // 使用的密码学算法集
      &quot;crypto_type&quot;: &quot;SM&quot;,
       // executor地址
      &quot;executor_addr&quot;: &quot;localhost:50002&quot;
    },
  },
  // 当前会话的环境配置
  &quot;current_context&quot;: {
    &quot;account_name&quot;: &quot;default&quot;,
    &quot;controller_addr&quot;: &quot;localhost:50004&quot;,
    &quot;crypto_type&quot;: &quot;SM&quot;,
    &quot;executor_addr&quot;: &quot;localhost:50004&quot;
  },
  // 启动时默认使用的环境配置的名字
  &quot;default_context&quot;: &quot;default&quot;
}
</code></pre>
<h2 id="context-save"><a class="header" href="#context-save">context save</a></h2>
<p>保存当前会话的环境配置。</p>
<pre><code class="language-plaintext">cldi context save &lt;context-name&gt;
</code></pre>
<h3 id="示例-3"><a class="header" href="#示例-3">示例</a></h3>
<p>将当前环境配置保存成一个名为new的环境配置。</p>
<pre><code class="language-plaintext">cldi&gt; context save new
</code></pre>
<p>以test这个环境配置为基础，controller地址localhost:50004，executor地址localhost:50002，账号名为admin，保存一个名为admin的环境配置。</p>
<pre><code class="language-plaintext">cldi&gt; -c test -r localhost:50004 -e localhost:50002 -u admin context save admin
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="admin"><a class="header" href="#admin">admin</a></h1>
<p>admin相关命令，用于管理链的配置。</p>
<pre><code class="language-plaintext">$ cldi help admin
cldi-admin
The admin commands for managing chain

USAGE:
    cldi admin &lt;SUBCOMMAND&gt;

OPTIONS:
    -h, --help    Print help information

SUBCOMMANDS:
    update-admin          Update admin of the chain
    update-validators     Update validators of the chain
    set-block-interval    Set block interval
    emergency-brake       Send emergency brake cmd to chain
    set-quota-limit       Set quota limit
    help                  Print this message or the help of the given subcommand(s)
</code></pre>
<p>这些命令必须以链的管理员账号发送，否则链上会返回错误。具体来说，当前账户的地址必须和链配置的管理员地址一致。</p>
<p>admin下的所有命令都是通过向链发送UTXO交易来完成的。请参考<a href="https://github.com/cita-cloud/rfcs/blob/master/rfcs/0002-technology/0002-technology.md#%E7%B3%BB%E7%BB%9F%E9%85%8D%E7%BD%AE">相关的RFC</a>。</p>
<p>UTXO交易的数据格式是controller内部定义的，最早的参考实现为<a href="https://github.com/cita-cloud/tools">tools</a>。</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rpc"><a class="header" href="#rpc">rpc</a></h1>
<p>未分类的rpc命令。</p>
<pre><code class="language-plaintext">$ cldi help rpc
Other RPC commands

Usage: cldi rpc &lt;COMMAND&gt;

Commands:
  add-node        call add-node rpc
  store-abi       Store EVM contract ABI
  parse-proof     parse consensus proof
  estimate-quota  estimate quota a specified transaction will cost
  help            Print this message or the help of the given subcommand(s)

Options:
  -h, --help  Print help information
</code></pre>
<h2 id="add-node"><a class="header" href="#add-node">add-node</a></h2>
<p>调用controller的<code>add-node</code>接口，这个接口曾用于让network微服务连接一个新的节点。</p>
<pre><code class="language-plaintext">$ cldi rpc add-node -h
cldi-rpc-add-node
call add-node rpc

USAGE:
    cldi rpc add-node &lt;port&gt; &lt;domain&gt;

ARGS:
    &lt;port&gt;      the port of the new node
    &lt;domain&gt;    the domain name of the new node

OPTIONS:
    -h, --help    Print help information
</code></pre>
<h2 id="store-abi"><a class="header" href="#store-abi">store-abi</a></h2>
<p>通过发送交易，在链上保存合约的<code>ABI</code>。</p>
<pre><code class="language-plaintext">$ cldi rpc store-abi -h
cldi-rpc-store-abi
Store EVM contract ABI

USAGE:
    cldi rpc store-abi [OPTIONS] &lt;addr&gt; &lt;abi&gt;

ARGS:
    &lt;addr&gt;
    &lt;abi&gt;

OPTIONS:
    -q, --quota &lt;quota&gt;                the quota of this tx [default: 1073741824]
        --until &lt;valid-until-block&gt;    this tx is valid until the given block height. `+h` means
                                       `&lt;current-height&gt; + h` [default: +95]
    -h, --help                         Print help information
</code></pre>
<h3 id="parse-proof"><a class="header" href="#parse-proof">parse-proof</a></h3>
<p>从字节码解析并打印共识的Proof信息，默认<code>crypto-type</code>为<code>SM</code>，默认<code>consensus-type</code>为<code>OVERLORD</code></p>
<pre><code class="language-plaintext">$ cldi rpc parse-proof -h
cldi-rpc-parse-proof 
parse consensus proof

USAGE:
    cldi rpc parse-proof [OPTIONS] &lt;proof&gt;

ARGS:
    &lt;proof&gt;    plain proof data with `0x` prefix

OPTIONS:
        --crypto &lt;crypto-type&gt;          The crypto type of the proof. [default:
                                        &lt;current-context-crypto-type&gt;] [possible values: SM, ETH]
    -h, --help                          Print help information
</code></pre>
<h3 id="estimate-quota"><a class="header" href="#estimate-quota">estimate-quota</a></h3>
<p>估算执行给定交易将花费的<code>quota</code></p>
<pre><code class="language-plaintext">$ cldi rpc estimate-quota -h
estimate quota a specified transaction will cost

Usage: cldi rpc estimate-quota &lt;data&gt; [to]

Arguments:
  &lt;data&gt;  the data of this call request
  [to]    the target contract address, empty means create contract

Options:
  -h, --help  Print help information
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ethabi"><a class="header" href="#ethabi">ethabi</a></h1>
<p>这个子命令来自<a href="https://github.com/rust-ethereum/ethabi">ethabi</a>，请参考官方文档。</p>
<pre><code class="language-plaintext">$ cldi help ethabi
cldi-ethabi 17.0.0
Parity Technologies &lt;admin@parity.io&gt;
Artem Vorotnikov &lt;artem@vorotnikov.me&gt;
Nicholas Rodrigues Lordello &lt;nlordell@gmail.com&gt;
Ethereum ABI coder.

USAGE:
    cldi ethabi &lt;SUBCOMMAND&gt;

OPTIONS:
    -h, --help       Print help information
    -V, --version    Print version information

SUBCOMMANDS:
    encode    Encode ABI call.
    decode    Decode ABI call result.
    help      Print this message or the help of the given subcommand(s)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bench"><a class="header" href="#bench">bench</a></h1>
<p>简单的性能测试工具。</p>
<pre><code class="language-plaintext">$ cldi help bench
cldi-bench
Simple benchmarks

USAGE:
    cldi bench &lt;SUBCOMMAND&gt;

OPTIONS:
    -h, --help    Print help information

SUBCOMMANDS:
    send    Send transactions with {-c} workers over {--connections} connections
    call    Call executor with {-c} workers over {--connections} connections
    help    Print this message or the help of the given subcommand(s)
</code></pre>
<p>目前支持测试发送交易(send)和executor调用(call)。</p>
<h2 id="通用参数"><a class="header" href="#通用参数">通用参数</a></h2>
<pre><code class="language-plaintext">ARGS:
    &lt;total&gt;    Number of tasks in the benchmark [default: 10000]

OPTIONS:
    -c, --concurrency &lt;concurrency&gt;    Number of request workers to run concurrently. Workers will
                                       be distributed evenly among all the connections. [default:
                                       the same as total]
        --connections &lt;connections&gt;    Number of connections connects to server [default: 1]
        --timeout &lt;timeout&gt;            Timeout for each request (in seconds). 0 means no timeout
                                       [default: 0]
</code></pre>
<ul>
<li>位置参数<code>&lt;total&gt;</code>代表总共发多少个请求，默认请求数为10000。</li>
<li><code>-c</code>或<code>--concurrency</code>用来指定并发数，代表同一时刻最多有多少请求在并发进行，默认是所有请求都是并发发出的。</li>
<li><code>--connections</code>是使用的连接数，<code>cldi</code>发起的gRPC请求是会在同一条连接上多路复用的，增加连接数在一定范围内能提高发送速度，默认连接数为1。</li>
<li><code>--timeout</code>是请求的超时时间，单位是秒，默认为0，即不设置超时。</li>
</ul>
<h2 id="bench-send"><a class="header" href="#bench-send">bench-send</a></h2>
<pre><code class="language-plaintext">$ cldi bench send -h
cldi-bench-send
Send transactions with {-c} workers over {--connections} connections

USAGE:
    cldi bench send [OPTIONS] [total]

ARGS:
    &lt;total&gt;    Number of tasks in the benchmark [default: 10000]

OPTIONS:
    -c, --concurrency &lt;concurrency&gt;    Number of request workers to run concurrently. Workers will
                                       be distributed evenly among all the connections. [default:
                                       the same as total]
        --connections &lt;connections&gt;    Number of connections connects to server [default: 1]
        --timeout &lt;timeout&gt;            Timeout for each request (in seconds). 0 means no timeout
                                       [default: 0]
    -t, --to &lt;to&gt;                      the target address of this tx. Default to random
    -d, --data &lt;data&gt;                  the data of this tx. Default to random 32 bytes
    -v, --value &lt;value&gt;                the value of this tx [default: 0x0]
    -q, --quota &lt;quota&gt;                the quota of this tx [default: 200000]
        --until &lt;valid-until-block&gt;    this tx is valid until the given block height. `+h` means
                                       `&lt;current-height&gt; + h` [default: +95]
        --disable-watch                don't watch blocks
    -h, --help                         Print help information
</code></pre>
<h2 id="bench-call"><a class="header" href="#bench-call">bench-call</a></h2>
<pre><code class="language-plaintext">$ cldi bench call -h
cldi-bench-call
Call executor with {-c} workers over {--connections} connections

USAGE:
    cldi bench call [OPTIONS] [total]

ARGS:
    &lt;total&gt;    Number of tasks in the benchmark [default: 10000]

OPTIONS:
    -c, --concurrency &lt;concurrency&gt;    Number of request workers to run concurrently. Workers will
                                       be distributed evenly among all the connections. [default:
                                       the same as total]
        --connections &lt;connections&gt;    Number of connections connects to server [default: 1]
        --timeout &lt;timeout&gt;            Timeout for each request (in seconds). 0 means no timeout
                                       [default: 0]
    -f, --from &lt;from&gt;                  Default to use current account address
    -t, --to &lt;to&gt;                      the target contract address to call. Default to random
    -d, --data &lt;data&gt;                  the data for the call request. Default to random 32 bytes
        --height &lt;height&gt;              the height for the call request. Default ro current height
    -h, --help                         Print help information
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="watch"><a class="header" href="#watch">watch</a></h1>
<p>观察当前链的出块情况。展示的时间是块头的时间戳，并且会以开始观察的第一个块时间戳为起始时间00:00。</p>
<pre><code class="language-plaintext">$ cldi help watch
cldi-watch
Watch blocks

USAGE:
    cldi watch [OPTIONS]

OPTIONS:
    -b, --begin &lt;begin&gt;
            the block height starts from. You can use +/- prefix to seek from current height

    -e, --end &lt;end&gt;
            the block height ends at. You can use +/- prefix to seek from current height

    -t, --until &lt;until-finalized-txs&gt;
            stop watching when finalized txs reach the given limit

    -h, --help
            Print help information
</code></pre>
<p>示例</p>
<pre><code class="language-plaintext"># 从当前块开始观察
cldi&gt; watch
# 从当前块开始观察，直到有100笔交易上链
cldi&gt; watch --until 100
# 从块高0到块高10
cldi&gt; watch --begin 0 --end 10
# 从当前块高-10到当前块高+10
cldi&gt; watch --begin -10 --end +10
# 使用缩写
cldi&gt; w --begin -10 --end +10 --until 100
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="completions"><a class="header" href="#completions">completions</a></h1>
<p>命令行模式下的补全。</p>
<pre><code class="language-plaintext">$ cldi help completions
cldi-completions
Generate completions for current shell. Add the output script to `.profile` or `.bashrc` etc. to
make it effective.

USAGE:
    cldi completions &lt;shell&gt;

ARGS:
    &lt;shell&gt;    [possible values: bash, zsh, powershell, fish, elvish]

OPTIONS:
    -h, --help    Print help information
</code></pre>
<p>这个命令会输出补全脚本，需要添加到例如<code>.profile</code>, <code>.bashrc</code>里才能生效。</p>
<p>以bash为例，将下列脚本添加到<code>.bashrc</code>里即可。</p>
<pre><code class="language-bash">source &lt;(cldi completions bash)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="设计架构"><a class="header" href="#设计架构">设计架构</a></h1>
<p>TODO: 有生之年</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="开发指南"><a class="header" href="#开发指南">开发指南</a></h1>
<p>参考<code>cloud-cli/src/cmd</code>下的命令实现。</p>
<p>需要异步的话可以从Context里拿到runtime，用这个runtime去block_on即可执行异步任务。</p>
<p>需要client的什么功能，就在Context相应的泛型里加上相应的trait约束。
如果觉得泛型太复杂，也可以把它去掉，把所有泛型都用具体的类型替换掉。</p>
<p>TODO: 有生之年</p>
<h2 id="todo"><a class="header" href="#todo">TODO</a></h2>
<ul>
<li>把错误处理做好一点，现在用anyhow糊不太好，建议用thiserror做一些具体的类型，然后上层可以做一些判断，打印更有帮助的错误信息。</li>
<li>交互模式下的补全，考虑到clap可以构造一些很复杂的命令，想要做对会比较麻烦。好消息是补全本身的实现有rustyline。</li>
<li>mock测试。</li>
<li>给help加个h缩写，可能要绕一下，参考completions的写法。</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="错误排查"><a class="header" href="#错误排查">错误排查</a></h1>
<p>TODO: 欢迎贡献文档</p>
<h2 id="编译失败提示feature-unstable"><a class="header" href="#编译失败提示feature-unstable">编译失败，提示feature unstable</a></h2>
<p>rust版本不够新，更新即可。</p>
<pre><code class="language-plaintext">$ rustup update
</code></pre>
<h2 id="connection-refused"><a class="header" href="#connection-refused">Connection refused</a></h2>
<p>和链建立连接被拒绝，请检查当前环境配置的controller_addr和executor_addr。</p>
<pre><code class="language-plaintext">$ cldi ctx ls
</code></pre>
<h2 id="admin-check-error"><a class="header" href="#admin-check-error">Admin Check Error</a></h2>
<p>admin命令需要使用管理员账户，管理员账户是在启链时设置的。</p>
<h2 id="no-get-receipt"><a class="header" href="#no-get-receipt">No get receipt</a></h2>
<p>这个是<code>executor_evm</code>返回的报错，一般有两种情况：</p>
<ul>
<li>交易没有上链</li>
<li>试图获取admin命令发送的UTXO交易的回执。UTXO交易在<code>executor_evm</code>里不处理，没有回执。</li>
</ul>
<h2 id="account-locked"><a class="header" href="#account-locked">Account locked</a></h2>
<p>当前账户带密码，使用<code>-p</code>指定密码。</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
